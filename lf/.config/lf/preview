#!/usr/bin/env bash
preview="$1"
[[ -f "$preview" ]] || exit 1

txt() {
    command -v batcat >/dev/null && batcat --style=plain --color=always "$preview" && return
    command -v bat >/dev/null && bat --style=plain --color=always "$preview" && return
    command -v highlight >/dev/null && highlight --out-format=ansi "$preview" && return
    cat "$preview"
}

case "$preview" in
    *.png|*.jpg|*.jpeg|*.bmp|*.webp|*.gif)
        command -v chafa >/dev/null && chafa "$preview" --scale max && exit
        ;;
    *.mp4|*.mkv|*.webm|*.mp3|*.flac|*.ogg|*.wav)
        command -v ffprobe >/dev/null && ffprobe -hide_banner "$preview" 2>/dev/null && exit
        ;;
    *.tar|*.tar.gz|*.tgz|*.tar.bz2|*.zip|*.rar|*.7z)
        command -v bsdtar >/dev/null && bsdtar -tf "$preview" 2>/dev/null && exit
        ;;
    *.pdf)
        command -v pdftotext >/dev/null && pdftotext "$preview" - 2>/dev/null | head -n 80 && exit
        ;;
    *.md)
        command -v glow >/dev/null && glow -s dark "$preview" && exit
        txt
        ;;
    *.json)
        command -v jq >/dev/null && jq . "$preview" 2>/dev/null || txt
        ;;
    *.yml|*.yaml)
        command -v yq >/dev/null && yq . "$preview" 2>/dev/null || txt
        ;;
    *.html|*.htm)
        command -v lynx >/dev/null && lynx -dump "$preview" 2>/dev/null && exit
        command -v w3m >/dev/null && w3m -dump "$preview" 2>/dev/null && exit
        txt
        ;;
    *)
        txt
        ;;
esac

